package taxSystem2;


import java.util.ArrayList;

public abstract class Taxpayer {
	private String name = "nobody";
	private int afm = 0;
	private String familyStatus = "none";
	private float income = 0;
	private ArrayList<Receipt> receipts = new ArrayList<Receipt>();
	
	public abstract double getBasicTax();
	
	public int getTotalReceipsGathered(){
		return receipts.size();
	}
	
	public int getCategoryNumberOfReceipts(String receiptCategory){
		int categoryNumberOfReceipts = 0;
		for(int i=0; i<receipts.size(); i++){
			if(receipts.get(i).getCategory().equals(receiptCategory)){
				categoryNumberOfReceipts += 1;
			}
		}
		return categoryNumberOfReceipts;
	}
	
	public double getCategoryReceiptAmountPaid(String receiptCategory){
		double categoryReceiptAmountPaid = 0;
		for(int i=0; i<receipts.size(); i++){
			if(receipts.get(i).getCategory().equals(receiptCategory)){
				categoryReceiptAmountPaid += receipts.get(i).getAmountPaid();
			}
		}
		return categoryReceiptAmountPaid;
	}
	
	public double getTaxIncrease(){
		double receiptTotalAmountPaid = this.getReceiptTotalAmountPaid();
		if(receiptTotalAmountPaid >= 0*income/100 && receiptTotalAmountPaid < 20*income/100){
			return 8*income / 100;
		}
		else if(receiptTotalAmountPaid >= 20*income/100 && receiptTotalAmountPaid < 40*income/100){
			return 4*income / 100;
		}
		else if(receiptTotalAmountPaid >= 40*income/100 && receiptTotalAmountPaid < 60*income/100){
			return (-1)*15*income / 100;
		}
		else if(receiptTotalAmountPaid >= 60*income/100){
			return (-1)*30*income / 100;
		}
		else{
			System.out.println("Something went wrong calculating tax increase!");
			return -1;
		}
	}
	
	private double getReceiptTotalAmountPaid(){
		double receiptTotalAmountPaid = 0;
		for(int i=0; i<receipts.size(); i++){
			receiptTotalAmountPaid += receipts.get(i).getAmountPaid();
		}
		return receiptTotalAmountPaid;
	}
	
	public double getTotalTax(){
		double basicTax = this.getBasicTax();
		double taxIncrease = this.getTaxIncrease();
		return basicTax + taxIncrease;
	}
	
	public ArrayList<Receipt> getReceipts(){
		return receipts;
	}
	
	public void setReceipts(ArrayList<Receipt> receipts){
		this.receipts = receipts;
	}
	
	public Taxpayer getInitializedTaxpayer(ArrayList<String> myList){
		initializeTaxpayer(myList);
		return this;
	}
	
	public void initializeTaxpayer(ArrayList<String> myList){
		name = myList.get(0);
        myList.remove(0);
        afm = Integer.parseInt(myList.get(0));
        myList.remove(0);
        familyStatus = myList.get(0);
        myList.remove(0);
        income = Integer.parseInt(myList.get(0));
        myList.remove(0);
        
        //TODO last piece of this small puzzle
        int i = 0;
        while(i<myList.size()){
        	ArrayList<String> receiptDataList = new ArrayList<String>();
        	Receipt newReceipt = new Receipt();
        	//System.out.println("mY LIST" + myList);
        	for(int j=i; j<i+9; j++){
        		receiptDataList.add(myList.get(j));
        		//System.out.println("Inserted to receiptDtaList : " + myList.get(j));
        	}
        	System.out.println("myList : " + myList);
        	System.out.println("receiptDataList : " + receiptDataList);
        	newReceipt.initializeReceipt(receiptDataList);
        	receipts.add(newReceipt);
        	i=i+9;
        }
	}
	
	public String getFamilyStatus(){
		return familyStatus;
	}
	
	public void setFamilyStatus(String familyStatus){
		this.familyStatus = familyStatus;
	}
	
	public float getIncome(){
		return income;
	}
	
	public void setIncome(float income){
		this.income = income;
	}
	
	public String getName(){
		return name;
	}
	
	public void setName(String name){
		this.name = name;
	}
	
	public int getAfm(){
		return afm;
	}
	
	public void setAfm(int afm){
		this.afm = afm;
	}
	
	public String toString(){
		System.out.println("--------------------------------------------------------------------------------------------------------");
		System.out.println(" name : " + name + " afm : " + afm + " family status : " + familyStatus + " income : " + income);
		for(int i=0; i<receipts.size(); i++){
			System.out.println(receipts.get(i).toString());
		}
		return "--------------------------------------------------------------------------------------------------------";
	}
}