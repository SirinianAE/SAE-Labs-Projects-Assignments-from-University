package outputManager;

import java.io.File;
import java.io.IOException;
import java.io.PrintWriter;
import java.util.ArrayList;
import taxpayer.Taxpayer;

public class LogFileCreator{
	private String domain;
	//00
	private Taxpayer outputManagerTaxpayer;// = new SingleTaxpayer();
	private String textFullDomain;// = createFullDomainForTextFile();
	private String xmlFullDomain;// = createFullDomainForXmlFile();
	private File xmlFile = new File(xmlFullDomain);
	private File textFile = new File(textFullDomain);
	private ArrayList<String> bunchOfDataForTextFile =
			new ArrayList<String>();
	private ArrayList<String> bunchOfDataForXmlFile =
			new ArrayList<String>();
	private ArrayList<String> bunchOfUsefulData =
			createBunchOfUsefulData();
	private ArrayList<String> bunchOfOpeningTagData = 
			createBunchOfOpeningTagDataForXmlFile();
	
	public LogFileCreator(String domain, Taxpayer outputManagerTaxpayer){
		this.domain = domain;
		this.outputManagerTaxpayer = outputManagerTaxpayer;
		textFullDomain = createFullDomainForTextFile();
	}

	public void createLogTextFile(){
		completeBunchOfDataForTextFile();
		try{
			PrintWriter output = new PrintWriter(textFile);
			for(String myString: bunchOfDataForTextFile){
				output.println(myString);
			}
			output.close();
		}catch (IOException ex){
			System.out.printf("ERROR: %s\n", ex);
		}
	}

	public void createLogXmlFile(){
		completeBunchOfDataForXmlFile();
		try{
			PrintWriter output = new PrintWriter(xmlFile);
			for(String myString: bunchOfDataForXmlFile){
				output.println(myString);
			}
			output.close();
		}catch (IOException ex){
			System.out.printf("ERROR: %s\n", ex);
		}
	}
	
	private void completeBunchOfDataForTextFile(){
		for(int i=0; i<bunchOfUsefulData.size(); i++){
			bunchOfDataForTextFile.add(createStartingTextFormat(
					bunchOfOpeningTagData.get(i)) +
					bunchOfUsefulData.get(i));
		}
	}
	
	private void completeBunchOfDataForXmlFile(){
		for(int i=0; i<bunchOfUsefulData.size(); i++){
			bunchOfDataForXmlFile.add(createStartingXmlFormat(
					bunchOfOpeningTagData.get(i)) +
					bunchOfUsefulData.get(i) +
					createFinishingXmlFormat(bunchOfOpeningTagData
							.get(i)));
		}
	}
	
	//TODO change methods and variables names
	private ArrayList<String> createBunchOfOpeningTagDataForXmlFile()
	{
		ArrayList<String> bunchOfOpeningTagData = 
				new ArrayList<String>();
		bunchOfOpeningTagData.add("Name");
		bunchOfOpeningTagData.add("AFM");
		bunchOfOpeningTagData.add("Income");
		bunchOfOpeningTagData.add("BasicTax");
		bunchOfOpeningTagData.add("TaxIncrease");
		bunchOfOpeningTagData.add("TotalTax");
		bunchOfOpeningTagData.add("Receipts");
		bunchOfOpeningTagData.add("Entertainment");
		bunchOfOpeningTagData.add("Basic");
		bunchOfOpeningTagData.add("Travel");
		bunchOfOpeningTagData.add("Health");
		bunchOfOpeningTagData.add("Other");
		return bunchOfOpeningTagData;
	}
	
	private ArrayList<String> createBunchOfUsefulData(){
		ArrayList<String> bunchOfData =
				outputManagerTaxpayer.getTaxpayerBunchOfData();
		ArrayList<String> bunchOfUsefulData = new ArrayList<String>();
		bunchOfUsefulData.add(bunchOfData.get(0));
		bunchOfUsefulData.add(bunchOfData.get(1));
		bunchOfUsefulData.add(bunchOfData.get(3));
		bunchOfUsefulData.add(bunchOfData.get(4));
		bunchOfUsefulData.add(bunchOfData.get(5));
		bunchOfUsefulData.add(bunchOfData.get(6));
		bunchOfUsefulData.add(bunchOfData.get(7));
		bunchOfUsefulData.add(bunchOfData.get(8));
		bunchOfUsefulData.add(bunchOfData.get(9));
		bunchOfUsefulData.add(bunchOfData.get(10));
		bunchOfUsefulData.add(bunchOfData.get(11));
		bunchOfUsefulData.add(bunchOfData.get(12));
		return bunchOfUsefulData;
	}
	
	public void setDomain(String domain){
		this.domain = domain;
	}
	
	private String createFullDomainForTextFile(){
		ArrayList<String> bunchOfData =
				outputManagerTaxpayer.getTaxpayerBunchOfData();
		return domain + bunchOfData.get(1) + "_LOG.txt";
	}
	
	private String createFullDomainForXmlFile(){
		ArrayList<String> bunchOfData =
				outputManagerTaxpayer.getTaxpayerBunchOfData();
		return domain + bunchOfData.get(1) + "_LOG.xml";
	}
	
	private String createStartingXmlFormat(String keyWord){
		return "<"+keyWord+"> ";
	}
	
	private String createFinishingXmlFormat(String keyWord){
		return " </"+keyWord+">";
	}
	
	private String createStartingTextFormat(String keyWord){
		return keyWord+": ";
	}
	
	public void setOutputManagerTaxpayer(
			Taxpayer outputManagerTaxpayer){
		this.outputManagerTaxpayer = outputManagerTaxpayer;
	}
}